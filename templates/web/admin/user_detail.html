{% extends 'web/base.html' %}
{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {{ user.username }}{% endblock %}
{% block content %}
<div style="max-width: 1000px; margin: 0 auto; padding: 20px;">
	<h1>üë§ {{ user.username }}</h1>
	
	<!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
	<div style="background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e5e7eb;">
		<h2 style="margin: 0 0 15px 0;">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
		<table style="width: 100%;">
			<tr>
				<td style="padding: 8px 0; color: #6b7280; width: 200px;">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</td>
				<td style="padding: 8px 0;"><strong>{{ user.username }}</strong></td>
			</tr>
			<tr>
				<td style="padding: 8px 0; color: #6b7280;">Email:</td>
				<td style="padding: 8px 0;">{{ user.email|default:"‚Äî" }}</td>
			</tr>
			<tr>
				<td style="padding: 8px 0; color: #6b7280;">–§–ò–û:</td>
				<td style="padding: 8px 0;">{{ user.first_name }} {{ user.last_name }}</td>
			</tr>
			{% if profile %}
			<tr>
				<td style="padding: 8px 0; color: #6b7280;">–†–æ–ª—å:</td>
				<td style="padding: 8px 0;">
					<span style="padding: 4px 8px; border-radius: 4px; font-size: 0.9em;
						{% if profile.role == 'admin' %}background: #fee2e2; color: #991b1b;
						{% elif profile.role == 'manager' %}background: #dbeafe; color: #1e40af;
						{% elif profile.role == 'buyer' %}background: #dcfce7; color: #166534;
						{% else %}background: #f3f4f6; color: #6b7280;{% endif %}">
						{{ profile.get_role_display }}
					</span>
				</td>
			</tr>
			<tr>
				<td style="padding: 8px 0; color: #6b7280;">–°—Ç–∞—Ç—É—Å:</td>
				<td style="padding: 8px 0;">
					{% if profile.is_blocked %}
						<span style="color: #ef4444; font-weight: 600;">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
						{% if profile.blocked_reason %}
							<br><small style="color: #6b7280;">–ü—Ä–∏—á–∏–Ω–∞: {{ profile.blocked_reason }}</small>
						{% endif %}
					{% else %}
						<span style="color: #10b981; font-weight: 600;">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
					{% endif %}
				</td>
			</tr>
			<tr>
				<td style="padding: 8px 0; color: #6b7280;">–¢–µ–ª–µ—Ñ–æ–Ω:</td>
				<td style="padding: 8px 0;">{{ profile.phone|default:"‚Äî" }}</td>
			</tr>
			<tr>
				<td style="padding: 8px 0; color: #6b7280;">–ì–æ—Ä–æ–¥:</td>
				<td style="padding: 8px 0;">{{ profile.city|default:"‚Äî" }}</td>
			</tr>
			{% endif %}
			<tr>
				<td style="padding: 8px 0; color: #6b7280;">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</td>
				<td style="padding: 8px 0;">{{ user.date_joined|date:"d.m.Y H:i" }}</td>
			</tr>
		</table>
	</div>
	
	<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
	<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
		<div style="background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
			<h3 style="margin: 0 0 10px 0; color: #6b7280; font-size: 0.9em;">–ó–∞–∫–∞–∑–æ–≤:</h3>
			<p style="font-size: 2em; margin: 0; color: #2563eb; font-weight: bold;">{{ total_orders }}</p>
		</div>
		<div style="background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
			<h3 style="margin: 0 0 10px 0; color: #6b7280; font-size: 0.9em;">–ü–æ—Ç—Ä–∞—Ç–∏–ª:</h3>
			<p style="font-size: 2em; margin: 0; color: #10b981; font-weight: bold;">{{ total_spent }} ‚ÇΩ</p>
		</div>
		<div style="background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
			<h3 style="margin: 0 0 10px 0; color: #6b7280; font-size: 0.9em;">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫:</h3>
			<p style="font-size: 2em; margin: 0; color: #f59e0b; font-weight: bold;">{{ avg_order_value|floatformat:0 }} ‚ÇΩ</p>
		</div>
	</div>
	
	<!-- –î–µ–π—Å—Ç–≤–∏—è -->
	<div style="background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e5e7eb;">
		<h2 style="margin: 0 0 15px 0;">–î–µ–π—Å—Ç–≤–∏—è</h2>
		
		<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
		<div style="margin-bottom: 15px;">
			{% if profile and profile.is_blocked %}
			<form method="post" action="/admin/users/{{ user.id }}/block/">
				{% csrf_token %}
				<input type="hidden" name="action" value="unblock">
				<button type="submit" style="background: #10b981; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">
					‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
				</button>
			</form>
			{% else %}
			<form method="post" action="/admin/users/{{ user.id }}/block/" style="display: flex; gap: 10px; align-items: start;">
				{% csrf_token %}
				<input type="hidden" name="action" value="block">
				<input type="text" name="reason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏" required 
				       style="flex: 1; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px;">
				<button type="submit" style="background: #ef4444; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">
					üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
				</button>
			</form>
			{% endif %}
		</div>
		
		<!-- –°–º–µ–Ω–∞ —Ä–æ–ª–∏ -->
		<div style="margin-bottom: 15px;">
			<form method="post" action="/admin/users/{{ user.id }}/change-role/" style="display: flex; gap: 10px;">
				{% csrf_token %}
				<select name="role" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; flex: 1;">
					<option value="guest" {% if profile and profile.role == 'guest' %}selected{% endif %}>–ì–æ—Å—Ç—å</option>
					<option value="buyer" {% if profile and profile.role == 'buyer' %}selected{% endif %}>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</option>
					<option value="manager" {% if profile and profile.role == 'manager' %}selected{% endif %}>–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
					<option value="admin" {% if profile and profile.role == 'admin' %}selected{% endif %}>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
				</select>
				<button type="submit" style="background: #2563eb; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">
					üíº –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å
				</button>
			</form>
		</div>
		
		<!-- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ -->
		<div style="margin-bottom: 15px;">
			<a href="/admin/users/{{ user.id }}/activity/" style="background: #6b7280; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-block;">
				üìä –õ–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
			</a>
		</div>
		
		<!-- –£–¥–∞–ª–µ–Ω–∏–µ -->
		<form method="post" action="/admin/users/{{ user.id }}/delete/" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.');">
			{% csrf_token %}
			<button type="submit" style="background: #991b1b; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">
				üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
			</button>
		</form>
	</div>
	
	<!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã -->
	{% if orders %}
	<div style="background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
		<h2 style="margin: 0 0 15px 0;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h2>
		<table style="width: 100%; border-collapse: collapse;">
			<thead style="background: #f9fafb;">
				<tr>
					<th style="padding: 10px; text-align: left;">‚Ññ –ó–∞–∫–∞–∑–∞</th>
					<th style="padding: 10px; text-align: left;">–î–∞—Ç–∞</th>
					<th style="padding: 10px; text-align: right;">–°—É–º–º–∞</th>
					<th style="padding: 10px; text-align: center;">–°—Ç–∞—Ç—É—Å</th>
				</tr>
			</thead>
			<tbody>
				{% for order in orders %}
				<tr style="border-top: 1px solid #e5e7eb;">
					<td style="padding: 10px;">#{{ order.id }}</td>
					<td style="padding: 10px;">{{ order.created_at|date:"d.m.Y H:i" }}</td>
					<td style="padding: 10px; text-align: right; font-weight: 600;">{{ order.total_amount }} ‚ÇΩ</td>
					<td style="padding: 10px; text-align: center;">
						{{ order.get_status_display }}
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
	{% endif %}
</div>
{% endblock %}



