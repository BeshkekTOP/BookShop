{% extends 'web/base.html' %}
{% block title %}–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤{% endblock %}
{% block content %}
<div style="max-width: 800px; margin: 0 auto; padding: 20px;">
	<h1>‚úçÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h1>
	
	<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ -->
	<div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
		<h2 style="margin: 0 0 10px 0;">{{ book.title }}</h2>
		<p style="margin: 0; color: #6b7280;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ book.category.name }}</p>
	</div>
	
	<!-- –§–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ -->
	<div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px;">
		{% if existing_review %}
		<div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 6px; padding: 15px; margin-bottom: 20px;">
			<p style="margin: 0;"><strong>–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –æ—Ç–∑—ã–≤:</strong></p>
			<p style="margin: 5px 0;">–û—Ü–µ–Ω–∫–∞: ‚≠ê {{ existing_review.rating }}/5</p>
			{% if existing_review.text %}
			<p style="margin: 5px 0;">{{ existing_review.text }}</p>
			{% endif %}
		</div>
		{% endif %}
		
		<div style="background: #e0f2fe; border: 1px solid #0ea5e9; border-radius: 6px; padding: 15px; margin-bottom: 20px;">
			<p style="margin: 0; color: #0c4a6e;"><strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∑—ã–≤–∞ –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–Ω–∏–≥–∏.</p>
		</div>
		
		<form method="post" action="">
			{% csrf_token %}
			
			<div style="margin-bottom: 20px;">
				<label style="display: block; margin-bottom: 8px; font-weight: 600;">–û—Ü–µ–Ω–∫–∞ *:</label>
				<div style="display: flex; gap: 8px; justify-content: center;">
					{% for i in "12345" %}
					<label style="cursor: pointer; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; text-align: center; flex: 1; transition: all 0.2s; background: #fff;" 
					       onmouseover="this.style.borderColor='#3b82f6'; this.style.backgroundColor='#eff6ff';" 
					       onmouseout="this.style.borderColor='#e5e7eb'; this.style.backgroundColor='#fff';">
						<input type="radio" name="rating" value="{{ forloop.counter }}" 
						       {% if existing_review and existing_review.rating == forloop.counter %}checked{% endif %}
						       required style="display: none;" 
						       onchange="updateStarSelection(this)">
						<div style="font-size: 1.8em; margin-bottom: 4px;">‚≠ê</div>
						<div style="font-size: 0.9em; font-weight: 600; color: #374151;">{{ forloop.counter }}</div>
					</label>
					{% endfor %}
				</div>
				<small style="color: #6b7280; font-size: 0.9em; text-align: center; display: block; margin-top: 8px;">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5 –∑–≤–µ–∑–¥</small>
			</div>
			
			<div style="margin-bottom: 20px;">
				<label style="display: block; margin-bottom: 8px; font-weight: 600;">–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞:</label>
				<textarea name="text" rows="6" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤ –æ –∫–Ω–∏–≥–µ..." 
				          style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; resize: vertical;">{% if existing_review %}{{ existing_review.text }}{% endif %}</textarea>
			</div>
			
			<div style="display: flex; gap: 10px;">
				<button type="submit" class="btn">
					{% if existing_review %}–û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–∑—ã–≤{% else %}–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤{% endif %}
				</button>
				<a href="/books/{{ book.id }}/" class="btn" style="background: #6b7280;">–ù–∞–∑–∞–¥ –∫ –∫–Ω–∏–≥–µ</a>
			</div>
		</form>
		
		{% if existing_review %}
		<form method="post" action="/reviews/{{ book.id }}/delete/" 
		      onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –æ—Ç–∑—ã–≤?');" 
		      style="margin-top: 15px;">
			{% csrf_token %}
			<button type="submit" style="color: #ef4444; background: none; border: none; cursor: pointer; text-decoration: underline;">
				üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤
			</button>
		</form>
		{% endif %}
	</div>
</div>

<script>
function updateStarSelection(selectedValue) {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∑–≤–µ–∑–¥—ã
    const allLabels = document.querySelectorAll('label');
    allLabels.forEach(label => {
        if (label.querySelector('input[name="rating"]')) {
            label.style.borderColor = '#e5e7eb';
            label.style.backgroundColor = '#fff';
        }
    });
    
    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∑–≤–µ–∑–¥—É –∏ –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ
    for (let i = 1; i <= selectedValue; i++) {
        const input = document.querySelector(`input[name="rating"][value="${i}"]`);
        if (input) {
            const label = input.parentElement;
            label.style.borderColor = '#10b981';
            label.style.backgroundColor = '#ecfdf5';
        }
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö radio –∫–Ω–æ–ø–æ–∫
    const ratingInputs = document.querySelectorAll('input[name="rating"]');
    ratingInputs.forEach(input => {
        input.addEventListener('change', function() {
            updateStarSelection(parseInt(this.value));
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ label
        const label = input.parentElement;
        label.addEventListener('click', function(e) {
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã radio —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
            setTimeout(() => {
                const checkedInput = document.querySelector('input[name="rating"]:checked');
                if (checkedInput) {
                    updateStarSelection(parseInt(checkedInput.value));
                }
            }, 10);
        });
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
    const checkedInput = document.querySelector('input[name="rating"]:checked');
    if (checkedInput) {
        updateStarSelection(parseInt(checkedInput.value));
    }
});
</script>
{% endblock %}



