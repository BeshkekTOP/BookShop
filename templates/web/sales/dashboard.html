{% extends 'web/base.html' %}
{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂{% endblock %}
{% block content %}
<div class="container">
	<div class="fade-in">
		<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
		<div class="flex justify-between items-center mb-8">
			<div>
				<h1 class="text-3xl font-bold text-primary mb-2">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</h1>
				<p class="text-secondary">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –∫–Ω–∏–≥</p>
			</div>
			<div class="flex gap-3">
				<select id="period-select" class="form-select" style="width: auto;">
					<option value="week" {% if period == 'week' %}selected{% endif %}>–ó–∞ –Ω–µ–¥–µ–ª—é</option>
					<option value="month" {% if period == 'month' %}selected{% endif %}>–ó–∞ –º–µ—Å—è—Ü</option>
					<option value="quarter" {% if period == 'quarter' %}selected{% endif %}>–ó–∞ –∫–≤–∞—Ä—Ç–∞–ª</option>
				</select>
				<a href="/admin/reports/" class="btn btn-primary">üìà –û—Ç—á–µ—Ç—ã</a>
			</div>
		</div>

		<!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
		<div class="grid grid-cols-4 gap-6 mb-8">
			<div class="stat-card">
				<div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
				<div class="stat-value">{{ total_revenue|floatformat:0 }} ‚ÇΩ</div>
				{% if yesterday_stats %}
				<div class="stat-change {% if total_revenue > yesterday_stats.total_revenue %}positive{% else %}negative{% endif %}">
					{% if total_revenue > yesterday_stats.total_revenue %}‚Üó{% else %}‚Üò{% endif %}
					{{ total_revenue|sub:yesterday_stats.total_revenue|floatformat:0 }} ‚ÇΩ
				</div>
				{% endif %}
			</div>
			
			<div class="stat-card">
				<div class="stat-label">–ó–∞–∫–∞–∑–æ–≤</div>
				<div class="stat-value">{{ total_orders }}</div>
				{% if yesterday_stats %}
				<div class="stat-change {% if total_orders > yesterday_stats.total_orders %}positive{% else %}negative{% endif %}">
					{% if total_orders > yesterday_stats.total_orders %}‚Üó{% else %}‚Üò{% endif %}
					{{ total_orders|sub:yesterday_stats.total_orders }}
				</div>
				{% endif %}
			</div>
			
			<div class="stat-card">
				<div class="stat-label">–ö–Ω–∏–≥ –ø—Ä–æ–¥–∞–Ω–æ</div>
				<div class="stat-value">{{ total_books_sold }}</div>
				{% if yesterday_stats %}
				<div class="stat-change {% if total_books_sold > yesterday_stats.total_books_sold %}positive{% else %}negative{% endif %}">
					{% if total_books_sold > yesterday_stats.total_books_sold %}‚Üó{% else %}‚Üò{% endif %}
					{{ total_books_sold|sub:yesterday_stats.total_books_sold }}
				</div>
				{% endif %}
			</div>
			
			<div class="stat-card">
				<div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
				<div class="stat-value">{{ avg_order_value|floatformat:0 }} ‚ÇΩ</div>
				{% if yesterday_stats %}
				<div class="stat-change {% if avg_order_value > yesterday_stats.average_order_value %}positive{% else %}negative{% endif %}">
					{% if avg_order_value > yesterday_stats.average_order_value %}‚Üó{% else %}‚Üò{% endif %}
					{{ avg_order_value|sub:yesterday_stats.average_order_value|floatformat:0 }} ‚ÇΩ
				</div>
				{% endif %}
			</div>
		</div>

		<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è -->
		{% if today_stats %}
		<div class="card mb-8">
			<div class="card-header">
				<h2 class="card-title">üìÖ –°–µ–≥–æ–¥–Ω—è</h2>
				<p class="card-subtitle">{{ today|date:"d.m.Y" }}</p>
			</div>
			<div class="grid grid-cols-4 gap-4">
				<div class="text-center">
					<div class="text-2xl font-bold text-primary">{{ today_stats.total_orders }}</div>
					<div class="text-sm text-secondary">–ó–∞–∫–∞–∑–æ–≤</div>
				</div>
				<div class="text-center">
					<div class="text-2xl font-bold text-success">{{ today_stats.total_revenue|floatformat:0 }} ‚ÇΩ</div>
					<div class="text-sm text-secondary">–í—ã—Ä—É—á–∫–∞</div>
				</div>
				<div class="text-center">
					<div class="text-2xl font-bold text-warning">{{ today_stats.total_books_sold }}</div>
					<div class="text-sm text-secondary">–ö–Ω–∏–≥ –ø—Ä–æ–¥–∞–Ω–æ</div>
				</div>
				<div class="text-center">
					<div class="text-2xl font-bold text-primary">{{ today_stats.average_order_value|floatformat:0 }} ‚ÇΩ</div>
					<div class="text-sm text-secondary">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
				</div>
			</div>
		</div>
		{% endif %}

		<!-- –¢–æ–ø-10 –∫–Ω–∏–≥ -->
		<div class="grid grid-cols-2 gap-8 mb-8">
			<div class="card">
				<div class="card-header">
					<h2 class="card-title">üìö –¢–æ–ø-10 –∫–Ω–∏–≥ –∑–∞ –ø–µ—Ä–∏–æ–¥</h2>
					<p class="card-subtitle">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–æ–¥–∞–∂</p>
				</div>
				<div class="card-body">
					{% if top_books %}
					<div class="space-y-3">
						{% for book in top_books %}
						<div class="flex justify-between items-center p-3 rounded-lg" style="background: var(--bg-tertiary);">
							<div>
								<div class="font-semibold">{{ book.book__title }}</div>
								<div class="text-sm text-secondary">{{ book.book__author__name }}</div>
							</div>
							<div class="text-right">
								<div class="font-bold">{{ book.total_quantity }} —à—Ç.</div>
								<div class="text-sm text-secondary">{{ book.total_revenue|floatformat:0 }} ‚ÇΩ</div>
							</div>
						</div>
						{% endfor %}
					</div>
					{% else %}
					<div class="text-center py-8 text-secondary">
						<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
					</div>
					{% endif %}
				</div>
			</div>

			<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
			<div class="card">
				<div class="card-header">
					<h2 class="card-title">üë• –ö–ª–∏–µ–Ω—Ç—ã</h2>
					<p class="card-subtitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º</p>
				</div>
				<div class="card-body">
					<div class="space-y-4">
						<div class="flex justify-between items-center">
							<span class="text-secondary">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤:</span>
							<span class="font-bold">{{ total_customers }}</span>
						</div>
						<div class="flex justify-between items-center">
							<span class="text-secondary">–ù–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã:</span>
							<span class="font-bold text-success">{{ new_customers }}</span>
						</div>
						<div class="flex justify-between items-center">
							<span class="text-secondary">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã:</span>
							<span class="font-bold text-primary">{{ returning_customers }}</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂ -->
		<div class="card">
			<div class="card-header">
				<h2 class="card-title">üìà –î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</h2>
				<p class="card-subtitle">–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂ –ø–æ –¥–Ω—è–º</p>
			</div>
			<div class="card-body">
				{% if daily_stats %}
				<div class="overflow-x-auto">
					<table class="table">
						<thead>
							<tr>
								<th>–î–∞—Ç–∞</th>
								<th>–ó–∞–∫–∞–∑—ã</th>
								<th>–í—ã—Ä—É—á–∫–∞</th>
								<th>–ö–Ω–∏–≥ –ø—Ä–æ–¥–∞–Ω–æ</th>
								<th>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</th>
							</tr>
						</thead>
						<tbody>
							{% for stat in daily_stats %}
							<tr>
								<td>{{ stat.date|date:"d.m.Y" }}</td>
								<td class="font-semibold">{{ stat.total_orders }}</td>
								<td class="font-semibold text-success">{{ stat.total_revenue|floatformat:0 }} ‚ÇΩ</td>
								<td class="font-semibold">{{ stat.total_books_sold }}</td>
								<td class="font-semibold">{{ stat.average_order_value|floatformat:0 }} ‚ÇΩ</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				{% else %}
				<div class="text-center py-8 text-secondary">
					<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
				</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>

<script>
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞
document.getElementById('period-select').addEventListener('change', function() {
    const period = this.value;
    const url = new URL(window.location);
    url.searchParams.set('period', period);
    window.location.href = url.toString();
});

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.stat-card, .card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            
            requestAnimationFrame(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            });
        }, index * 100);
    });
});
</script>

<style>
.space-y-3 > * + * {
    margin-top: 0.75rem;
}

.space-y-4 > * + * {
    margin-top: 1rem;
}

.text-primary {
    color: var(--text-primary);
}

.text-secondary {
    color: var(--text-secondary);
}

.text-success {
    color: var(--accent-success);
}

.text-warning {
    color: var(--accent-warning);
}

.text-error {
    color: var(--accent-error);
}
</style>
{% endblock %}






