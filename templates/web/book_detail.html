{% extends 'web/base.html' %}
{% block title %}{{ book.title }} ‚Äî –ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω{% endblock %}
{% block content %}
<article class="card">
	<h1 style="margin-top:0">{{ book.title }}</h1>
	
	<div style="margin-bottom: 1rem;">
		<p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ book.category.name }}</p>
		<p><strong>ISBN:</strong> {{ book.isbn }}</p>
		{% if authors %}
		<p><strong>–ê–≤—Ç–æ—Ä(—ã):</strong> 
			{% for author in authors %}
				{{ author.first_name }} {{ author.last_name }}{% if not forloop.last %}, {% endif %}
			{% endfor %}
		</p>
		{% endif %}
	</div>
	
	{% if book.description %}
	<div style="margin-bottom: 1rem;">
		<p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></p>
		<p>{{ book.description }}</p>
	</div>
	{% endif %}
	
	<div style="margin-bottom: 1rem;">
		<p><strong>–¶–µ–Ω–∞:</strong> <span style="font-size: 1.2em; color: #2563eb;">{{ book.price }} ‚ÇΩ</span></p>
		<p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> ‚≠ê {{ book.rating|floatformat:1 }}</p>
		{% if inventory %}
			{% if inventory.available > 0 %}
				<p style="color: green;"><strong>–ù–∞–ª–∏—á–∏–µ:</strong> –í –Ω–∞–ª–∏—á–∏–∏ ({{ inventory.available }} —à—Ç.)</p>
			{% else %}
				<p style="color: red;"><strong>–ù–∞–ª–∏—á–∏–µ:</strong> –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</p>
			{% endif %}
		{% endif %}
	</div>
	
	{% if user.is_authenticated %}
	<form method="post" action="/cart/" style="display:flex;gap:8px;align-items:center;margin-top: 1rem;">
		{% csrf_token %}
		<input type="hidden" name="book" value="{{ book.id }}" />
		<input type="hidden" name="action" value="add" />
		<input type="number" min="1" max="{% if inventory %}{{ inventory.available }}{% endif %}" 
		       name="quantity" value="1" style="max-width:100px" />
		<button type="submit" class="btn small" {% if inventory and inventory.available == 0 %}disabled{% endif %}>
			{% if inventory and inventory.available > 0 %}–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É{% else %}–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏{% endif %}
		</button>
	</form>
	{% else %}
	<div style="margin-top: 1rem; padding: 1rem; background-color: #fef3c7; border-radius: 8px;">
		<p style="margin: 0;">‚ö†Ô∏è –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–∏–≥ –≤ –∫–æ—Ä–∑–∏–Ω—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="/login/">–≤–æ–π—Ç–∏</a> –≤ —Å–∏—Å—Ç–µ–º—É.</p>
	</div>
	{% endif %}
	
	<!-- –û—Ç–∑—ã–≤—ã -->
	<div style="margin-top: 2rem;">
		<h2 style="font-size: 1.2em; margin-bottom: 1rem;">üìù –û—Ç–∑—ã–≤—ã –∏ –æ—Ü–µ–Ω–∫–∏</h2>
		
		{% if reviews %}
		<div style="display: flex; flex-direction: column; gap: 1rem;">
			{% for review in reviews %}
			<div style="border: 1px solid #e5e7eb; padding: 1rem; border-radius: 8px; background-color: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
				<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
					<div>
						<p style="margin: 0; font-weight: 600; color: #374151;">{{ review.user.username }}</p>
						<div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem;">
							<span style="color: #fbbf24;">‚≠ê</span>
							<span style="font-weight: 600;">{{ review.rating }}/5</span>
						</div>
					</div>
					<div style="text-align: right;">
						<small style="color: #6b7280;">{{ review.created_at|date:"d.m.Y H:i" }}</small>
						{% if user.is_authenticated and user == review.user %}
						<div style="margin-top: 0.5rem;">
							<a href="/reviews/{{ book.id }}/add/" style="color: #3b82f6; text-decoration: none; font-size: 0.9em; margin-right: 10px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
							<a href="/reviews/{{ book.id }}/delete/" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤?')" style="color: #ef4444; text-decoration: none; font-size: 0.9em;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
						</div>
						{% endif %}
					</div>
				</div>
				{% if review.text %}
				<div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #f3f4f6;">
					<p style="margin: 0; line-height: 1.5; color: #374151;">{{ review.text }}</p>
				</div>
				{% endif %}
			</div>
			{% endfor %}
		</div>
		{% else %}
		<div style="text-align: center; padding: 2rem; background-color: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
			<p style="margin: 0; color: #6b7280;">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
		</div>
		{% endif %}
		
		{% if user.is_authenticated %}
		<div style="margin-top: 1.5rem; text-align: center;">
			<a href="/reviews/{{ book.id }}/add/" class="btn" style="background: #10b981; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; display: inline-block;">
				‚úçÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
			</a>
		</div>
		{% else %}
		<div style="margin-top: 1rem; padding: 1rem; background-color: #fef3c7; border-radius: 8px; text-align: center;">
			<p style="margin: 0; color: #92400e;">–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="/login/" style="color: #d97706; font-weight: 600;">–≤–æ–π—Ç–∏</a> –≤ —Å–∏—Å—Ç–µ–º—É.</p>
		</div>
		{% endif %}
	</div>
</article>
{% endblock %}
